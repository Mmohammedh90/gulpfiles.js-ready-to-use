let canvas=document.querySelector("canvas"),ctx=canvas.getContext("2d"),size=350,cw=canvas.width=3*size,ch=canvas.height=3*size,dots=[],maxDots=999,tries=2e3,format=t=>t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),tl,baseHue,n;function init(t){for(;0<dots.length;)dots.pop();baseHue=gsap.utils.random(0,300,1),gsap.to("body",{duration:2,background:"hsl("+(baseHue+50)+",62%,95%)",ease:"power1.inOut"}),n=0,tl=gsap.timeline({onUpdate:render,paused:!0});for(let t=0;t<maxDots;t++)makeDots();tl.play(),console.clear(),console.log("Psst, it only took "+format(n)+" hit-tests to make "+dots.length+" dots.")}function makeDots(){let a;var t,e,o=Math.random()*Math.PI*2-Math.PI/2;for(let t=0;t<tries;t++)if(!hitTest(a={x:Math.round(Math.cos(o)*Math.random()*size),y:Math.round(Math.sin(o)*Math.random()*size),r:gsap.utils.random(8,11,1),l:gsap.utils.random(56,79,1),a:0,padding:gsap.utils.random(.8,1.3,.01),draw:!1})){a.draw=!0;break}a.draw&&(t=a.x-cw/size,e=a.y-ch/size,a.dist=Math.sqrt(t*t+e*e),dots.push(a),tl.add(gsap.to(a,{duration:1,ease:"power1.inOut",a:100}),.1+.3*Math.random()+a.dist/(size/2)))}function hitTest(a){for(let t=0;t<dots.length;t++){n++;var e=dots[t],o=a.x-e.x,s=a.y-e.y;if(Math.sqrt(o*o+s*s)<=a.r+e.r)return!0}return!1}function drawDot(t){ctx.translate(cw/2,ch/2),ctx.beginPath(),ctx.arc(t.x,t.y,t.r-t.padding,0,2*Math.PI),ctx.fillStyle="hsla("+(baseHue+t.dist/4.15)+", 95%, "+t.l+"%, "+t.a+"%)",ctx.fill(),ctx.translate(-cw/2,-ch/2)}function render(){ctx.clearRect(0,0,cw,ch),dots.forEach(drawDot)}window.onload=window.onclick=init;